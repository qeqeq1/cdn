"use strict";var messagePort=null,n=[],r=!1,s=!1,i="?popout"===window.location.search,a={xfreleaseNum:10400,isDebug:!0,type:"boot"};(new MessageChannel).port1;function o(e){if(e.port&&!messagePort)(messagePort=e.port).onmessage=l;if(r=!!e.isDebug,s=!!e.isDebugFrame,window.xf_isDebugFrame=s,e.xfreleaseNum,r)e.port=null,window.xf_debugBootMessage=e;if(window.initDebugger)window.initDebugger();var t="ready";if(s)t="boot-debug-ready";else if(i)t="debug-popout-ready";window.xf_postToMessagePort({type:t})}function l(e){if(n.length)for(var t=0;t<n.length;t++){(0,n[t])(e.data)}else console.warn("[Preview] No message handler functions for port message: ",e.data)}function e(){var e=window.opener||window.parent;if(e&&e!==window)e.postMessage({type:"boot-ready"},"*");var t=location.pathname;if(-1<t.indexOf("debug.html")||-1<t.indexOf("debugTest.html"))o(a)}if(window.addEventListener("message",function(e){var t=e.data,n=t.type;if("messageport-init"===n)!function(e){if(!messagePort)(messagePort=e.port).onmessage=l,messagePort.postMessage({type:"messageport-received"})}(t);else if("boot"===n||"boot-debug-frame"===n)o(t);else if("register-sw"===n);else console.warn("Unexpected message type '"+n+"'")}),window.xf_addPortMessageHandler=function(e){n.push(e)},window.xf_postToMessagePort=function(e){if(messagePort)messagePort.postMessage(e);else console.warn("[Preview] No message port to post data down: ",e)},"loading"===document.readyState)document.addEventListener("DOMContentLoaded",e);else e();var g={data:{"common-props.common.iid":"IID","common-props.common.name":"名称","common-props.common.title":"通用","common-props.common.uid":"UID","common-props.instance-variables":"实例变量","common-props.layout.angle":"角度","common-props.layout.collisions-enabled":"启用碰撞？","common-props.layout.height":"高度","common-props.layout.layer":"图层组","common-props.layout.opacity":"透明度","common-props.layout.title":"布局","common-props.layout.visible":"可见性","common-props.layout.width":"宽度","common-props.layout.x":"X坐标","common-props.layout.y":"Y坐标","common-props.layout.MovingTargetX":"对象移动目标点X","common-props.layout.MovingTargetY":"对象移动目标点Y","common-props.layout.MovingSpeed":"对象移动速度","common-props.layout.MovingAngle":"对象移动角度","common-props.layout.z-index":"Z轴编号",false:"假","free-edition-limit":"该功能未开启.","free-edition-limit-edit-values":"该功能未开启.","inspect.container-header":"容器","inspect.container-instance":"{0} UID {1}","inspect.destroy-button":"销毁","inspect.highlight-check":"高亮","inspect.instance-destroyed":"选中的实例 ('{0}' UID {1})已经被销毁。","inspect.tools-header":"工具",loading:"加载中","loading-percent":"加载中: {0}%","main-buttons.continue":"继续","main-buttons.load":"载入","main-buttons.load-tooltip":"载入之前保存的状态","main-buttons.next":"下一步","main-buttons.pause":"暂停","main-buttons.popout-tooltip":"点击切换调试器中的面板","main-buttons.restart":"重启","main-buttons.resume":"恢复","main-buttons.save":"保存","main-buttons.save-tooltip":"保存当前状态","main-buttons.step":"下一步","perf-summary.cpu":"{0}% CPU使用","perf-summary.fps":"{0} 帧每秒","perf-summary.gpu":"{0}% GPU使用","perf-summary.image-mem":"{0}mb","perf-summary.object-count.one":"{0}对象","perf-summary.object-count.other":"{0}个对象","profiler.description":"请注意，该区域仅测量CPU时间。所有值都是估计的，当浏览器使用多线程渲染时，“渲染调用”可能会被低估。GPU渲染次数没有显示，帧数可能会被GPU性能所限制","profiler.draw-calls":"渲染调用","profiler.engine":"引擎","profiler.events":"事件","profiler.physics-simulation":"物理模拟","state.hit-breakpoint":"达到断点: {0}","state.paused":"暂停","state.running":"运行中","state.suspended":"等待","system-object-name":"系统","system.global-variables":"全局变量","system.layer.angle":"角度","system.layer.force-own-texture":"强制渲染为纹理","system.layer.index":"编号","system.layer.opacity":"透明度","system.layer.parallax-x":"水平方向视差","system.layer.parallax-y":"垂直方向视差","system.layer.scale":"缩放倍数","system.layer.title":"图层组: {0}","system.layer.transparent":"透明","system.layer.viewport-bottom":"视窗底边","system.layer.viewport-left":"视窗左边","system.layer.viewport-right":"视窗右边","system.layer.viewport-top":"视窗上边","system.layer.visible":"可见？","system.layer.zoom-rate":"缩放率","system.layout.angle":"角度","system.layout.event-sheet":"事件表","system.layout.height":"高度","system.layout.name":"名称","system.layout.scale":"缩放倍数","system.layout.scroll-x":"水平滚动","system.layout.scroll-y":"垂直滚动","system.layout.title":"当前场景","system.layout.width":"宽度","system.performance.cell-count":"网格数量","system.performance.collision-checks":"每秒碰撞检测数","system.performance.cpu":"估计CPU使用率","system.performance.fps":"每秒帧数","system.performance.fps-value":"{0} ({1} 毫秒/帧)","system.performance.image-mem":"估计图片内存占用","system.performance.image-mem-unavailable":"不可用","system.performance.image-mem-value":"{0} mb","system.performance.moved-cell":"每秒移动网格数","system.performance.moved-render-cell":"每秒渲染移动网格数","system.performance.object-count":"对象数量","system.performance.poly-checks":"每秒多边形检测数","system.performance.render-cell-count":"渲染网格数","system.performance.renderer":"渲染器","system.performance.title":"性能","system.performance.value-per-tick":"{0} (~{1}/帧)","system.static-local-variables":"静态局部变量","system.system.canvas-size":"画布尺寸","system.system.tick-count":"帧计数","system.system.time":"时间","system.system.time-scale":"时间尺度","system.system.title":"系统","system.system.wallclock-time":"真实时间","tabs.inspect":"整体调试","tabs.profile":"Profile","tabs.watch":"监视器",title:"调试器","title-tooltip":"拖动缩放该面板",true:"真","watch.add-item":"添加到监视器","watch.add-section":"将区域添加到监视器","watch.instance-uid":"{0} UID {1}","watch.remove-item":"从监视器移除","watch.remove-section":"将区域从监视器移除"},type:"lang"};function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,s=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){s=!0,i=e}finally{try{if(!r&&null!=o.return)o.return()}finally{if(s)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}window.localStorage_getItem=function(e){try{return localStorage.getItem(e)}catch(e){return null}},window.localStorage_setItem=function(e,t){try{localStorage.setItem(e,t)}catch(e){}};var f=location.href,t=f.lastIndexOf("/");if(-1!==t)f=f.substr(0,t+1);var d=null,p=null,m=!1;window.xfDebugger={isPopout:!1,isLoading:!0,isFirstInspect:!1,popoutWindow:null,isAwaitingPopout:!1,popoutMessagePort:null,objectListElem:null,iframeElem:null,iframeWrapElem:null,iframeHasLoaded:!1,mainElem:null,inspectViewElem:null,inspectView2Elem:null,variableViewElem:null,watchViewElem:null,statusElem:null,perfStatsElem:null,leftPaneElem:null,rightPaneElem:null,perfPaneElem:null,perfTableWrapElem:null,topBarElem:null,sideElem:null,watchPaneElem:null,objectElements:{},propertyHeaders:{},currentTab:"inspect",baseHref:f};var c=null,b=null,x=null,y=null,D=null,h=null,w=null,E=null,v=null,P=!1,C=!1,T=!1,I=new Map;function L(e){var t=e.data.type;if("boot-ready"===t){if(xfDebugger.isAwaitingPopout){var n=new MessageChannel;xfDebugger.popoutMessagePort=n.port1,xfDebugger.popoutMessagePort.onmessage=k,window.xf_debugBootMessage.port=n.port2,xfDebugger.popoutWindow.postMessage(window.xf_debugBootMessage,"*",[n.port2]),xfDebugger.isAwaitingPopout=!1}else if(xfDebugger.iframeHasLoaded=!0,d)xfDebugger.iframeElem.contentWindow.postMessage(d,"*",[d.port])}else console.warn("[Debugger] Unknown message type '"+t+"'")}function M(e){var t=e.data,n=t.type;if("boot-debug-ready"===n||"hit-breakpoint"===n||"debug-resume"===n)H(t);else if(!xfDebugger.isPopout&&xfDebugger.popoutWindow)!function(e){if(xfDebugger.popoutMessagePort)xfDebugger.popoutMessagePort.postMessage(e);else console.warn("[Debugger] Message for popout window but port not ready: ",e)}(t);else if("runtime"===t.from)H(t);else console.warn("Unknown debugger message from runtime: ",t)}function O(e){var t=e.type;if("runtime"===e.from)H(e);else if("lang"===t)B(e);else console.warn("Unknown debugger popout message from runtime: ",e)}function k(e){var t=e.data,n=t.type;if("debug-popout-ready"===n)xfDebugger.popoutMessagePort.postMessage(p),xfDebugger.PostToRuntime({type:"repostinit"});else if(t["closing-popout"])xfDebugger.onClosePopout();else if("restart"===n)W();else xfDebugger.PostToRuntime(t)}function V(e){var t=e.type;if("boot-debug-frame"===t){var n=new MessageChannel;if((c=n.port1).onmessage=M,e.port=n.port2,xfDebugger.iframeHasLoaded)xfDebugger.iframeElem.contentWindow.postMessage(e,"*",[e.port]);else d=e}else if("meta"===t){if(document.title=e.title,e.icon){var r=document.createElement("link");r.rel="icon",r.type="image/png",r.href=URL.createObjectURL(e.icon),document.head.appendChild(r)}c.postMessage(e)}else if("data"===t||"images"===t||"scripts"===t)c.postMessage(e);else if("reload"===t)if(m=!0,e.isDebug)location.reload(!1);else location.href=e.url;else if("debug-step"===t)j();else if("update-breakpoint"===t)xfDebugger.PostToRuntime(e);else if("close-window"===t)window.close();else if("lang"===t)B(p=e)}function B(e){for(var t=Object.entries(e.data),n=0;n<t.length;n++){var r=u(t[n],2),s=r[0],i=r[1];I.set(s,i)}xfDebugger.InitLang()}function H(e){var t=e.type;if("boot-debug-ready"===t)xfDebugger.iframeElem.contentWindow.focus(),xfDebugger.PostToEditor(e);else if("inst-inspect"===t)xfDebugger.OnInspectInstanceUpdate(e.sections,e.is_world,e.siblings,!1);else if("watch-inspect"===t)xfDebugger.OnInspectInstanceUpdate(e.sections,!1,null,!0);else if("inst-create"===t)for(var n=0,r=e.names.length;n<r;++n)xfDebugger.OnInstanceCreated(e.names[n],e.uid);else if("inst-destroy"===t)for(var s=0,i=e.names.length;s<i;++s)xfDebugger.OnInstanceDestroyed(e.names[s],e.uid,e["was-inspecting"]);else if("hit-breakpoint"===t||"debug-resume"===t)xfDebugger.PostToEditor(e);else if("perfstats"===t)xfDebugger.OnPerfStatsUpdate(e.fps,e.cpu,e.gpu,e.mem,e.renderer,e.objectcount,e.rendercpu,e.eventscpu,e.physicscpu,e.sheets_perf);else if("loadingprogress"===t)document.getElementById("status").textContent=xfDebugger.langSub("loading-percent",Math.round(e.progress));else if("init"===t)!function(e){var t=e.objects;xfDebugger.statusElem.style.display="none",xfDebugger.inspectView2Elem.style.display="block",w.style.display="",E.style.display="",h.textContent=xfDebugger.lang("state.running"),xfDebugger.AddObjectClassToList("System",!0);for(var n=0,r=t.length;n<r;++n){var s=t[n];if(xfDebugger.AddObjectClassToList(s.name,s.singleglobal),!s.singleglobal)for(var i=0,a=s.instances;i<a;++i)xfDebugger.OnInstanceCreated(s.name,-1)}if(e.paused)h.textContent=xfDebugger.lang("state.paused"),b.textContent=xfDebugger.lang("main-buttons.resume"),P=!0;else b.textContent=xfDebugger.lang("main-buttons.pause"),b.classList.remove("disabled"),C=P=!1;xfDebugger.isLoading=!1,xfDebugger.isFirstInspect=!0}(e);else if("reset"===t)xfDebugger.Reset();else if("suspend"===t)!function(e,t,n){if(e&&!P)if(C=!0,h.textContent=t?xfDebugger.langSub("state.hit-breakpoint",n):xfDebugger.lang("state.suspended"),t)b.textContent=xfDebugger.lang("main-buttons.continue"),b.classList.remove("disabled"),v.classList.remove("disabled"),v.textContent=xfDebugger.lang("main-buttons.next"),T=!0;else b.classList.add("disabled"),T=!1,v.textContent=xfDebugger.lang("main-buttons.step");if(!e){if(C=!1,P)h.textContent=xfDebugger.lang("state.paused"),xfDebugger.PostToRuntime({type:"pause"});else h.textContent=xfDebugger.lang("state.running"),b.classList.remove("disabled");v.textContent=xfDebugger.lang("main-buttons.step")}}(e.suspended,e.hit_breakpoint,e.hit_event);else if("fullscreen"===t)!function(e){try{if(!F)if("undefined"!=typeof nw)F=nw;else F=require("nw.gui");if(e){if(_)return;F.Window.get().enterFullscreen(),_=!0}else{if(!_)return;F.Window.get().leaveFullscreen(),_=!1}}catch(e){}}(e.enabled);else if("nocando"===t)xfDebugger.OnInspectTab();else if("nocando-edit"===t);else if("resize"===t||"closed"===t);else console.warn("[Debugger] Unknown message from runtime frame '"+t+"'",e)}function N(){if(!C||T)if(T)xfDebugger.PostToRuntime({type:"resumebreakpoint"}),h.textContent=xfDebugger.lang("state.running"),b.textContent=xfDebugger.lang("main-buttons.pause"),v.classList.add("disabled"),T=!1;else if(P)xfDebugger.PostToRuntime({type:"resume"}),h.textContent=xfDebugger.lang("state.running"),b.textContent=xfDebugger.lang("main-buttons.pause"),v.classList.add("disabled"),P=!1;else P=!0,xfDebugger.PostToRuntime({type:"pause"}),h.textContent=xfDebugger.lang("state.paused"),b.textContent=xfDebugger.lang("main-buttons.resume"),v.classList.remove("disabled")}function j(){if(P||T)xfDebugger.PostToRuntime({type:"step"})}function R(){xfDebugger.PostToRuntime({type:"save"})}function S(){xfDebugger.PostToRuntime({type:"load"})}function W(){if(xfDebugger.Reset(),xfDebugger.PostToRuntime({type:"restart"}),!xfDebugger.isPopout){var e=new MessageChannel;(c=e.port1).onmessage=M,d.port=e.port2}}function A(){if("watch"!==xfDebugger.currentTab)xfDebugger.leftPaneElem.style.display="none",xfDebugger.rightPaneElem.style.display="none",xfDebugger.perfPaneElem.style.display="none",xfDebugger.watchPaneElem.style.display="",xfDebugger.perfTableWrapElem.innerHTML="",xfDebugger.watchViewElem.innerHTML="",x.classList.add("inactive"),y.classList.remove("inactive"),D.classList.add("inactive"),xfDebugger.EndEditValue(!1),xfDebugger.inspectViewElem.innerHTML="",xfDebugger.propertyHeaders={},xfDebugger.isFirstInspect=!0,xfDebugger.currentTab="watch",xfDebugger.PostToRuntime({type:"switchtab",mode:"watch"})}function U(){if("profile"!==xfDebugger.currentTab)xfDebugger.leftPaneElem.style.display="none",xfDebugger.rightPaneElem.style.display="none",xfDebugger.perfPaneElem.style.display="",xfDebugger.watchPaneElem.style.display="none",xfDebugger.perfTableWrapElem.innerHTML="",xfDebugger.watchViewElem.innerHTML="",x.classList.add("inactive"),y.classList.add("inactive"),D.classList.remove("inactive"),xfDebugger.EndEditValue(!1),xfDebugger.inspectViewElem.innerHTML="",xfDebugger.propertyHeaders={},xfDebugger.isFirstInspect=!0,xfDebugger.currentTab="profile",xfDebugger.PostToRuntime({type:"switchtab",mode:"profile"})}window.initDebugger=function(){if(xfDebugger.isPopout="?popout"===window.location.search,xfDebugger.mainElem=document.getElementById("main"),xfDebugger.objectListElem=document.getElementById("objectlist"),xfDebugger.iframeElem=document.getElementById("theiframe"),xfDebugger.iframeWrapElem=document.getElementById("iframewrap"),xfDebugger.inspectViewElem=document.getElementById("inspectview"),xfDebugger.watchViewElem=document.getElementById("watchview"),xfDebugger.statusElem=document.getElementById("status"),xfDebugger.perfStatsElem=document.getElementById("perfstats"),xfDebugger.leftPaneElem=document.getElementById("leftpane"),xfDebugger.rightPaneElem=document.getElementById("rightpane"),xfDebugger.perfPaneElem=document.getElementById("perfpane"),xfDebugger.perfTableWrapElem=document.getElementById("perftablewrap"),xfDebugger.topBarElem=document.getElementById("topbar"),xfDebugger.sideElem=document.getElementById("side"),xfDebugger.watchPaneElem=document.getElementById("watchpane"),xfDebugger.variableViewElem=document.getElementById("variableview"),xfDebugger.inspectView2Elem=document.getElementById("inspectview2"),b=document.getElementById("pauseresume"),x=document.getElementById("inspect-tab"),y=document.getElementById("watch-tab"),D=document.getElementById("profile-tab"),h=document.getElementById("perRunStatus"),w=document.getElementById("controls"),E=document.getElementById("tabs"),v=document.getElementById("step"),xfDebugger.isPopout){xfDebugger.mainElem.style.display="none";var t=!(document.getElementById("topbarhandle").style.display="none"),e=function(e){if(!t)if(t=!0,window.xf_postToMessagePort({"closing-popout":!0}),e)window.nw.Window.get().close(!0)};if(window.nw&&window.nw.Window)window.nw.Window.get().on("close",function(){return e(!0)});else window.onbeforeunload=function(){return e(!1)}}else{var n=location.search.slice(1);if(n)window.localStorage.setItem("xf_debugger_search",n);history.replaceState(null,"",location.pathname),xfDebugger.iframeElem.src=f+"index.html?debug";var r=function(e){if(xfDebugger.popoutWindow)xfDebugger.popoutWindow.close();if(!m)xfDebugger.PostToEditor({from:"debugger",type:"closed",screenX:window.screenX,screenY:window.screenY});if(e)window.nw.Window.get().close(!0)};if(window.nw&&window.nw.Window)window.nw.Window.get().on("close",function(){return r(!0)});else window.addEventListener("unload",function(){return r(!1)})}if(window.addEventListener("message",L,!1),b.addEventListener("click",N),document.getElementById("step").addEventListener("click",j),document.getElementById("save").addEventListener("click",R),document.getElementById("load").addEventListener("click",S),document.getElementById("popoutdebugger").addEventListener("click",xfDebugger.OnPopoutDebugger),document.getElementById("restart").addEventListener("click",W),x.addEventListener("click",xfDebugger.OnInspectTab),y.addEventListener("click",A),D.addEventListener("click",U),document.getElementById("gripper").addEventListener("mousedown",xfDebugger.OnGripperMousedown),document.addEventListener("mousemove",xfDebugger.OnMouseMove),document.addEventListener("mouseup",xfDebugger.OnMouseUp),document.addEventListener("click",function(){return xfDebugger.EndEditValue(!0)}),xfDebugger.rightPaneElem.addEventListener("scroll",xfDebugger.UpdateEditInputPosition),document.addEventListener("keydown",z),window.nw&&window.nw.Window)nw.Window.get().show();if(xfDebugger.UpdateSize(),xfDebugger.isPopout)window.xf_addPortMessageHandler(O);else window.xf_addPortMessageHandler(V);!function(){B(p=g);var e=new MessageChannel;(c=e.port1).onmessage=M,(d={xfreleaseNum:10400,isDebug:!0,isDebugFrame:!0,type:"boot-debug-frame"}).port=e.port2}()},xfDebugger.PostToRuntime=function(e){if(!e.hasOwnProperty("from"))e.from="debugger";if(xfDebugger.isPopout)window.xf_postToMessagePort(e);else if(c)c.postMessage(e);else console.warn("[Debugger] Runtime message port not ready, message not sent: ",e)},xfDebugger.PostToEditor=function(e){if(!e.hasOwnProperty("from"))e.from="debugger";window.xf_postToMessagePort(e)},xfDebugger.Reset=function(){xfDebugger.EndEditValue(!1),xfDebugger.OnInspectTab(),xfDebugger.objectListElem.innerHTML="",C=P=!1,xfDebugger.iframeHasLoaded=!1,xfDebugger.statusElem.style.display="",w.style.display="none",E.style.display="none",v.classList.add("disabled"),xfDebugger.leftPaneElem.style.display="",xfDebugger.rightPaneElem.style.display="",xfDebugger.perfPaneElem.style.display="none",xfDebugger.watchPaneElem.style.display="none",xfDebugger.inspectViewElem.innerHTML="",xfDebugger.watchViewElem.innerHTML="",xfDebugger.isLoading=!0,xfDebugger.objectElements={},xfDebugger.propertyHeaders={},xfDebugger.InitLang()},xfDebugger.lang=function(e){var t=I.get(e);if(void 0===t)return console.warn("[LANG] Missing debugger language string '"+e+"'"),e;else return t},xfDebugger.langSub=function(e){var t=I.get(e);if(void 0===t)return console.warn("[LANG] Missing debugger language string '"+e+"'"),e;for(var n=arguments.length,r=new Array(1<n?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];for(var i=0,a=r.length;i<a;++i){var o="{".concat(i,"}");t=t.replace(o,r[i].toString())}return t},xfDebugger.InitLang=function(){var e=xfDebugger.lang;document.getElementById("topbarhandle").setAttribute("title",e("title-tooltip")),xfDebugger.statusElem.textContent=e("loading"),h.textContent=e("loading"),b.textContent=e("main-buttons.pause"),v.textContent=e("main-buttons.step"),document.getElementById("save").textContent=e("main-buttons.save"),document.getElementById("save").setAttribute("title",e("main-buttons.save-tooltip")),document.getElementById("load").textContent=e("main-buttons.load"),document.getElementById("load").setAttribute("title",e("main-buttons.load-tooltip")),document.getElementById("restart").textContent=e("main-buttons.restart"),document.getElementById("popoutdebugger").setAttribute("title",e("main-buttons.popout-tooltip")),x.textContent=e("tabs.inspect"),y.textContent=e("tabs.watch"),D.textContent=e("tabs.profile"),document.getElementById("perfnote").textContent=e("profiler.description")};var _=!(xfDebugger.OnInspectTab=function(){if("inspect"!==xfDebugger.currentTab)xfDebugger.leftPaneElem.style.display="",xfDebugger.rightPaneElem.style.display="",xfDebugger.perfPaneElem.style.display="none",xfDebugger.watchPaneElem.style.display="none",xfDebugger.perfTableWrapElem.innerHTML="",x.classList.remove("inactive"),y.classList.add("inactive"),D.classList.add("inactive"),xfDebugger.EndEditValue(!1),xfDebugger.inspectViewElem.innerHTML="",xfDebugger.propertyHeaders={},xfDebugger.isFirstInspect=!0,xfDebugger.currentTab="inspect",xfDebugger.PostToRuntime({type:"switchtab",mode:"inspect"})}),F=null;function z(e){if(27===e.which)xfDebugger.EndEditValue(!1);else if(13===e.which)xfDebugger.EndEditValue(!0);else if(121===e.which)j(),e.preventDefault()}var G=parseInt(localStorage_getItem("__sidesize"),10)||300,Y=G,X=!1,$=0;function J(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}xfDebugger.UpdateSize=function(){var e=window.innerWidth,t=window.innerHeight,n=xfDebugger.topBarElem.getBoundingClientRect().height;if(xfDebugger.isPopout)document.getElementById("popoutdebugger").className="popout-back",G=t,xfDebugger.sideElem.style.height=G+"px",xfDebugger.leftPaneElem.style.height=G-n+"px",xfDebugger.rightPaneElem.style.height=G-n+"px",xfDebugger.perfPaneElem.style.height=G-n+"px",xfDebugger.watchPaneElem.style.height=G-n+"px";else if(document.getElementById("popoutdebugger").className="",xfDebugger.popoutWindow)xfDebugger.mainElem.style.height=t+"px",xfDebugger.iframeWrapElem.style.width=e+"px",xfDebugger.iframeWrapElem.style.height=t+"px",xfDebugger.iframeElem.style.width=e+"px",xfDebugger.iframeElem.style.height=t+"px";else{if(G<n)G=n;if(t-50<G)G=t-50;xfDebugger.mainElem.style.height=t-G+"px",xfDebugger.iframeWrapElem.style.width=e+"px",xfDebugger.iframeWrapElem.style.height=t-G+"px",xfDebugger.iframeElem.style.width=e+"px",xfDebugger.iframeElem.style.height=t-G+"px",xfDebugger.sideElem.style.height=G+"px",xfDebugger.leftPaneElem.style.height=G-n+"px",xfDebugger.rightPaneElem.style.height=G-n+"px",xfDebugger.perfPaneElem.style.height=G-n+"px",xfDebugger.watchPaneElem.style.height=G-n+"px"}},window.addEventListener("resize",xfDebugger.UpdateSize),xfDebugger.OnGripperMousedown=function(e){if(!X&&!xfDebugger.isPopout)X=!0,$=e.screenY,Y=G,xfDebugger.iframeElem.style.pointerEvents="none"},xfDebugger.OnMouseMove=function(e){if(X){G=Y-(e.screenY-$);var t=xfDebugger.topBarElem.getBoundingClientRect().height,n=window.innerHeight;if(G<t)G=t;if(n-50<G)G=n-50;localStorage_setItem("__sidesize",G),xfDebugger.UpdateSize()}},xfDebugger.OnMouseUp=function(e){if(X)X=!1,xfDebugger.iframeElem.style.pointerEvents="auto"},xfDebugger.OnPopoutDebugger=function(){if(xfDebugger.isPopout)window.xf_postToMessagePort({"closing-popout":!0});else{xfDebugger.EndEditValue(!1);var e="menubar=no,toolbar=no,location=no,status=no,personalbar=no,width="+window.innerWidth+",height="+G+",resizable=yes,dependent=yes,minimizable=yes";if(/nwjs\//i.test(navigator.userAgent))e+=",left="+(window.screenX+50)+",top="+(window.screenY+50);xfDebugger.popoutWindow=window.open(xfDebugger.baseHref+"debug.html?popout","c2debugger",e),xfDebugger.sideElem.style.display="none",xfDebugger.UpdateSize(),xfDebugger.OnInspectTab(),xfDebugger.isAwaitingPopout=!0}};var K=!(xfDebugger.onClosePopout=function(){if(xfDebugger.isAwaitingPopout=!1,xfDebugger.popoutMessagePort)xfDebugger.popoutMessagePort.onmessage=null,xfDebugger.popoutMessagePort=null;xfDebugger.popoutWindow.close(),xfDebugger.popoutWindow=null,xfDebugger.sideElem.style.display="",xfDebugger.UpdateSize(),xfDebugger.Reset(),xfDebugger.PostToRuntime({type:"repostinit"}),xfDebugger.OnInspectTab()}),q=null,Z=null,Q=0,ee="",te="",ne="";function re(e,t){return t.profile-e.profile}xfDebugger.AddObjectClassToList=function(e,t){var n=null,r=null,s=document.createElement("li");if(!t)s.className="obj-collapsed";var i=document.createElement("a");if(i.className="obj-item",t)i.className=i.className?i.className+" obj-before":"obj-before";var a=e;if("System"===a)a=xfDebugger.lang("system-object-name");if(i.appendChild(document.createTextNode(a+" ")),!t)(n=document.createElement("span")).textContent="(0)",i.appendChild(n);if(i.addEventListener("click",xfDebugger.OnClickObjectInList),s.appendChild(i),!t){var o=document.createElement("div");o.className="wrapbox",r=document.createElement("ul"),o.appendChild(r),s.appendChild(o)}xfDebugger.objectListElem.appendChild(s),xfDebugger.objectElements[e]={instances:0,li:s,a:i,countspan:n,sublist:r,singleglobal:t}},xfDebugger.OnInstanceCreated=function(e,t){var n=xfDebugger.objectElements[e];if(n){var r=document.createElement("li");r.className="instance-li";var s=document.createElement("a");s.className="obj-instance",s.textContent="#"+n.instances,s.addEventListener("click",xfDebugger.OnClickInstance),r.appendChild(s),n.sublist.appendChild(r),n.instances++,n.countspan.textContent="("+n.instances+")"}},xfDebugger.OnInstanceDestroyed=function(e,t,n){if(n)xfDebugger.EndEditValue(!1),xfDebugger.inspectViewElem.innerHTML="",xfDebugger.statusElem.textContent=xfDebugger.langSub("inspect.instance-destroyed",e,t),xfDebugger.statusElem.style.display="",xfDebugger.propertyHeaders={};var r=xfDebugger.objectElements[e];if(r){var s=r.sublist;s.removeChild(s.lastChild),r.instances--,r.countspan.textContent="("+r.instances+")"}},xfDebugger.OnClickObjectInList=function(){var e=this.textContent,t=e.indexOf(" ");if((e=e.substr(0,t))===xfDebugger.lang("system-object-name"))e="System";if("System"===e)return xfDebugger.EndEditValue(!1),xfDebugger.inspectViewElem.innerHTML="",xfDebugger.statusElem.style.display="none",xfDebugger.inspectView2Elem.style.display="block",xfDebugger.propertyHeaders={},void xfDebugger.PostToRuntime({type:"inspectinstance",typename:"System",iid:-1});if(xfDebugger.objectElements[e]&&(1===xfDebugger.objectElements[e].instances||xfDebugger.objectElements[e].singleglobal))xfDebugger.EndEditValue(!1),xfDebugger.inspectViewElem.innerHTML="",xfDebugger.statusElem.style.display="none",xfDebugger.inspectView2Elem.style.display="block",xfDebugger.propertyHeaders={},xfDebugger.isFirstInspect=!0,xfDebugger.PostToRuntime({type:"inspectinstance",typename:e,iid:0});var n=this.parentElement;if(""!==n.className)if("obj-collapsed"===n.className)n.className="obj-expanded";else n.className="obj-collapsed"},xfDebugger.OnClickInstance=function(){var e=parseInt(this.textContent.substr(1),10),t=this.parentElement.parentElement.parentElement.previousSibling.textContent,n=t.indexOf(" ");t=t.substr(0,n),xfDebugger.EndEditValue(!1),xfDebugger.inspectViewElem.innerHTML="",xfDebugger.statusElem.style.display="none",xfDebugger.inspectView2Elem.style.display="block",xfDebugger.propertyHeaders={},xfDebugger.isFirstInspect=!0,xfDebugger.PostToRuntime({type:"inspectinstance",typename:t,iid:e})},xfDebugger.OnInspectInstanceUpdate=function(e,t,n,r){if(!xfDebugger.isLoading)if(!r||"watch"===xfDebugger.currentTab)if(r||"inspect"===xfDebugger.currentTab){var s=r?xfDebugger.watchViewElem:xfDebugger.inspectViewElem,i=xfDebugger.propertyHeaders;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];o.used=!1;var l=o.cells;for(var g in l)if(l.hasOwnProperty(g))l[g].used=!1}for(var u=0,f=e.length;u<f;++u){if(xfDebugger.isFirstInspect&&t&&1==u){var d=document.createElement("div");d.className="nobreakinside";var p=document.createElement("h3");p.className="property-section",p.textContent=xfDebugger.lang("inspect.tools-header"),d.appendChild(p);var m=document.createElement("input");m.type="button",m.className="destroy",m.onclick=xfDebugger.OnDestroyInspectedInstance,m.value=xfDebugger.lang("inspect.destroy-button"),d.appendChild(m);var c=document.createElement("label"),b=document.createElement("input");b.type="checkbox",b.className="checkbox",b.onclick=xfDebugger.OnToggleHighlight,b.checked=!0,c.appendChild(b),c.appendChild(document.createTextNode(xfDebugger.lang("inspect.highlight-check"))),d.appendChild(c),s.appendChild(d)}var x=e[u],y=null,D=null,h=void 0,w=null,E=void 0;if(Array.isArray(x.title))if(w=x.title,r){if("$"===(h=x.originalTitle).charAt(0))h=h.substr(1);E=w.map(function(e){if("$"===e.charAt(0)){var t;return(t=xfDebugger).langSub.apply(t,J(e.substr(1).split(",")))}else return e}).join("")}else{var v;h=w.join(","),E=(v=xfDebugger).langSub.apply(v,J(w))}else E=h=x.title;if(i.hasOwnProperty(h))y=i[h].table,D=i[h].cells,i[h].used=!0;else{var P=document.createElement("div");P.className="nobreakinside";var C=document.createElement("h3");if(C.className="property-section",C.textContent=E+" ",(y=document.createElement("ul")).className="property-table",D={},i[h]={header:C,table:y,cells:D,div:P,used:!0},P.appendChild(C),P.appendChild(y),x.title&&Array.isArray(x.title)&&"system.global-variables"==x.title[0])xfDebugger.variableViewElem.innerHTML="",xfDebugger.variableViewElem.appendChild(y);else s.appendChild(P)}for(var T=x.properties,I=0,L=T.length;I<L;++I){var M=T[I],O=null,k=null,V=void 0,B=null;if(Array.isArray(M.name))V=(B=M.name)[0];else V=M.name;var H=M.value;if(Array.isArray(H)){var N;H=(N=xfDebugger).langSub.apply(N,J(H))}var j=!1;if(D.hasOwnProperty(V))k=(O=D[V]).lastValue,O.used=!0;else{var R=document.createElement("li");R.className="property-row";var S=document.createElement("div");if(S.className="property-name",M.html)S.innerHTML=V;else if(B){var W;S.textContent=(W=xfDebugger).langSub.apply(W,J(B))}else S.textContent=V;if(S.textContent=S.textContent+":",R.appendChild(S),S=document.createElement("div"),M.readonly)S.className="property-value property-readonly";else S.className="property-value";var A=document.createElement("span");if(S.appendChild(A),O={cell:S,valuespan:A,row:R,lastValue:k=H,originalvalue:k,used:!0,propertyName:V,headerTitle:(w?"$":"")+h,displayTitle:E},D[V]=O,S.myinfo=O,R.appendChild(S),y.appendChild(R),!M.readonly)S.addEventListener("click",xfDebugger.OnClickEditableValue,!1);j=!0}if(k!==H||j){if(M.html)O.valuespan.innerHTML=H;else{var U=H;if("boolean"==typeof U)U=xfDebugger.lang(U?"true":"false");O.valuespan.textContent=U}if(O.lastValue=H,!K||H===O.originalvalue)O.cell.classList.remove("property-edited")}}}for(var _ in i)if(i.hasOwnProperty(_))if(!i[_].used)s.removeChild(i[_].div),delete i[_];else{var F=i[_].table,z=i[_].cells;for(var G in z)if(z.hasOwnProperty(G))if(!z[G].used)F.removeChild(z[G].row),delete z[G]}if(xfDebugger.isFirstInspect)if(n&&n.length){var Y=document.createElement("div");Y.className="nobreakinside";var X=document.createElement("h3");X.className="property-section",X.textContent=xfDebugger.lang("inspect.container-header"),Y.appendChild(X);for(var $=0,q=n.length;$<q;++$){var Z=document.createElement("a");Z.className="container-link",Z.textContent=xfDebugger.langSub("inspect.container-instance",n[$].typename,n[$].uid),Z.mytypename=n[$].typename,Z.myuid=n[$].uid,Z.onclick=xfDebugger.OnContainerLinkClick,Y.appendChild(Z),Y.appendChild(document.createElement("br"))}s.appendChild(Y)}xfDebugger.isFirstInspect=!1,K=!1}},xfDebugger.OnDestroyInspectedInstance=function(){xfDebugger.PostToRuntime({type:"destroy-inspect-inst"})},xfDebugger.OnToggleHighlight=function(){xfDebugger.PostToRuntime({type:"highlight",enabled:this.checked})},xfDebugger.OnContainerLinkClick=function(){xfDebugger.EndEditValue(!1),xfDebugger.inspectViewElem.innerHTML="",xfDebugger.statusElem.style.display="none",xfDebugger.inspectView2Elem.style.display="block",xfDebugger.propertyHeaders={},xfDebugger.isFirstInspect=!0,xfDebugger.PostToRuntime({type:"inspectinstance",uid:this.myuid})},xfDebugger.EndEditValue=function(e){if(q){if(e){var t,n=!1;if("number"==typeof Q){if(t=parseFloat(q.value),isFinite(t))n=!0}else if("string"==typeof Q)t=q.value,n=!0;else if("boolean"==typeof Q)t=0!==q.selectedIndex,n=!0;if(t!==Q&&n)xfDebugger.PostToRuntime({type:"editvalue",name:ee,header:te,displayHeader:ne,value:t}),Z.classList.add("property-edited"),K=!0}("watch"===xfDebugger.currentTab?xfDebugger.watchViewElem:xfDebugger.inspectViewElem).removeChild(q),Z=q=null,ne=te=ee="",Q=0}},xfDebugger.OnClickEditableValue=function(e){e.preventDefault(),e.stopPropagation(),xfDebugger.EndEditValue(!0);var t="watch"===xfDebugger.currentTab?xfDebugger.watchViewElem:xfDebugger.inspectViewElem;if("boolean"==typeof this.myinfo.lastValue){(q=document.createElement("select")).id="editvaluebool";var n=document.createElement("option");if(n.text=xfDebugger.lang("false"),!this.myinfo.lastValue)n.setAttribute("selected",!0);if(q.add(n,null),(n=document.createElement("option")).text=xfDebugger.lang("true"),this.myinfo.lastValue)n.setAttribute("selected",!0);q.add(n,null),q.onchange=xfDebugger.EndEditValue,Q=this.myinfo.lastValue,t.appendChild(q),q.selectedIndex=Q?1:0,Z=this,xfDebugger.UpdateEditInputPosition(),q.focus(),setTimeout(function(){var e=document.createEvent("MouseEvents");e.initMouseEvent("mousedown",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),q.dispatchEvent(e)},10)}else(q=document.createElement("input")).id="editvalue",q.type="text",q.value=this.myinfo.lastValue,Q=this.myinfo.lastValue,t.appendChild(q),Z=this,xfDebugger.UpdateEditInputPosition(),q.focus(),q.select();q.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation()}),ee=this.myinfo.propertyName,te=this.myinfo.headerTitle,ne=this.myinfo.displayTitle,setTimeout(function(){xfDebugger.UpdateEditInputPosition()},1)},xfDebugger.UpdateEditInputPosition=function(){if(Z&&q){var e="watch"===xfDebugger.currentTab?xfDebugger.watchPaneElem:xfDebugger.rightPaneElem,t=e.getBoundingClientRect(),n=Z.getBoundingClientRect();q.style.left=n.left-t.left+4+"px",q.style.top=n.top-t.top+e.scrollTop+3+"px",q.style.width=n.width-4+"px"}},xfDebugger.OnClickAddToWatch=function(e){e.stopPropagation();var t=this.myinfo;xfDebugger.PostToRuntime({type:"add-watch",headerTitle:t.headerTitle,propertyName:t.propertyName})},xfDebugger.OnClickAddHeaderToWatch=function(e){e.stopPropagation();var t=this.mytitle,n=t;if("$"===n.charAt(0))n=n.substr(1);var r=[];if(xfDebugger.propertyHeaders.hasOwnProperty(n)){var s=xfDebugger.propertyHeaders[n].cells;for(var i in s)if(s.hasOwnProperty(i))r.push(i);xfDebugger.PostToRuntime({type:"add-watch-header",headerTitle:t,propertyNames:r})}},xfDebugger.OnClickRemoveFromWatch=function(e){e.stopPropagation();var t=this.myinfo;xfDebugger.PostToRuntime({type:"remove-watch",headerTitle:t.headerTitle,displayTitle:t.displayTitle,propertyName:t.propertyName})},xfDebugger.OnClickRemoveHeaderFromWatch=function(e){e.stopPropagation(),xfDebugger.PostToRuntime({type:"remove-watch-header",headerTitle:this.mytitle,displayTitle:this.mydisplaytitle})},xfDebugger.GetProfileTableHtml=function(e,t){e.sort(re);for(var n='<table class="perftable">',r=0,s=e.length;r<s;++r){var i=e[r];if(n+='<tr><td class="perfitem">'.concat(i.name,'</td><td class="perfvalue"><strong>').concat(Math.round(i.profile)/10,"%</strong>"),i.sub_entries){var a=i.sub_entries;if(2<=t){for(var o=i.profile,l=0,g=a.length;l<g;++l)o-=a[l].profile;n+=" total; ".concat(Math.round(o)/10,"% self")}n+="<br/>"+xfDebugger.GetProfileTableHtml(a,t+1)}n+="</td></tr>"}return n+="</table>"},xfDebugger.OnPerfStatsUpdate=function(e,t,n,r,s,i,a,o,l,g){var u=xfDebugger.lang,f=xfDebugger.langSub;if(document.getElementById("perProName").textContent=document.title,document.getElementById("perCpu").textContent=Math.round(t/10)+"%",document.getElementById("perObjectNum").textContent=i,document.getElementById("perImgMem").textContent=f("perf-summary.image-mem",Math.round(10*r/1048576)/10),document.getElementById("perFrameRate").textContent=e,g.length){var d=[];d.push({name:u("profiler.draw-calls"),profile:a}),d.push({name:u("profiler.physics-simulation"),profile:l}),d.push({name:u("profiler.engine"),profile:t-a-o-l}),d.push({name:u("profiler.events"),profile:o,sub_entries:g}),xfDebugger.perfTableWrapElem.innerHTML=xfDebugger.GetProfileTableHtml(d,0)}};